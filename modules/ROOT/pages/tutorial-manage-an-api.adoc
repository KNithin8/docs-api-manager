= Applying an SLA-Based Policy
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

In this procedure, you configure and apply the Rate Limiting SLA-based policy to an API. You create the following two access SLA tiers that limit the number of app requests, based on the SLA level of the app:

* A tier that limits requests to three per minute, with no approval required
* A tier that limits requests to five per minute, with API Versions Owner approval required

When an app attempts to consume the protected API resource, the Rate Limiting SLA-based policy is enforced. Because this policy is client ID-based, app requests must include the expected user name/password. 

== Adding the Required RAML Snippet

. SLA-based rate limiting requires adding a RAML snippet to your RAML API. In an API instance's list of applied policies, a link to RAML snippets is required for the policy to appear.

. Specify the client ID and secret as query parameters. Add a section called `traits:` at the RAML's root level to define query parameters:
+
[source,yaml,linenums]
----
traits:
  - client-id-required:
      queryParameters:
       client_id:
        type: string
      client_secret:
        type: string
----

. Add the `client-id-required` trait to every method that requires these query parameters, for example:
+
[source,yaml,linenums]
----
/users:
  get:
    is: [client-id-required]
    description: Gets a list of JSONPlaceholder users.
----

== Adding the SLA Tier

. Select an API instance in the API dashboard (API Manager > *API Administration*).
. The API must support resource-level policies: verify that the API's *Type* is either RAML/OAS or HTTP.
. Click *SLA Tiers*, and then select *Add SLA Tier*. Specify a limit on the tier as follows:
+
* Name: Free
* Approval: Automatic
* Limits
** # of Reqs: 3
** Time Period: 1
** Time Unit: Minute
+
. Click *Add SLA Tier* again, and specify another limit on the tier as follows:
+
* Name: Premium
* Approval: Manual
* Limits
** # of Reqs: 5
** Time Period: 1
** Time Unit: Minute

== Applying the Policy

. Select *Policies*.
+
. Click *Apply New Policy*, select *Rate Limiting - SLA-based*, then click *Configure Policy*.
. In *Limits*, set the number of requests, time period, and units of measurement.
. Configure the policy on the API's `/users` resource:
* In *Method & Resource Conditions*, select *Apply Configurations to Specific Methods & Resources*.
* Under *Methods*, select GET.
* Under *URI Template Regex*, enter `/users` to apply rate limiting only to the `/users` resource, or enter `.*` to apply rate limiting to every resource URI of the API.
* Mule 4 use: Configure header propagation for token enforcement and rate limiting policies by checking the *Expose Headers* checkbox.
* Click *Apply*.
+
image::rlp-conditions.png[]
+
If a RAML spec is attached to your API, click *Preview resource matching* to verify which resources your filters affect.


== See Also

* xref:prepare-raml-task.adoc[Reviewing Traits & policies concepts of RAML based APIs]
* xref:resource-level-policies-about.adoc[About Resource Level Policies]
* xref:rate-limiting-sla-policy.adoc[Reviewing Rate-Limiting SLA Policy]
* xref:rate-limiting.adoc[Reviewing Rate Limiting Policy]
* xref:delete-sla-tier-task.adoc[Removing SLA Tiers on API Manager]