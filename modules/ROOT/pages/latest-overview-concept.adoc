= Reviewing API Manager Concepts
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: api, manager, raml
:page-aliases: general:getting-started:api-lifecycle-overview.adoc

API Manager is a component of Anypoint Platform for managing, governing, and securing APIs. The component leverages the runtime capabilities of API Gateway, which enforces policies, collects and tracks analytics data, manages proxies, provides industry standard encryption and authentications, and manages applications.

API Manager is tightly integrated with the following tools:

* Design Center for specifying the structure of the API
* Exchange for storing and publishing API assets
* Studio for implementing the API
+
Using Autodiscovery, API changes made in Studio are synchronized with the API registered in other tools, such as Design Center and API Manager.

The following flow diagram describes one possible relationship between the tools:

image::hello-world-flow-diagram.png[60%,60%]

. Build an API specification in Design Center.
. Publish the API specification from Design Center to Exchange.
. In Exchange, test the API against Mocking Service.
. In API Manager, via *Manage API*, import the API that was published to Exchange.
. In API Manager, apply a rate-limiting policy to the newly imported API. 
. In Studio, create a Mule application and download the API specification from Exchange.
. In Studio, implement and deploy the API.
. Test the API using a tool such as `curl`. 

== Basic Concepts
=== Policies
Policies enable you to enforce regulations to help manage security, control traffic, and improve adaptability of your APIs. For example, a policy can control authentication, access, allotted consumption, and service level access (SLA).

API Manager supports the following types of policies:

* Default Policies
* Automated Policies
* Custom Policies

=== SLA Tiers
Service Level Access (SLA) tiers are categories of user access that you define for an API. The tier definition combined with an SLA-based policy determines whether access to the API at a certain level requires your approval. The tier definition also can limit the number of requests an application can make to the API. To enforce SLA tiers, you need to apply a rate-limiting or throttling policy that is SLA-based.

=== Client Providers (Identity Providers)
Client providers authorize client applications.

=== Contracts
As the Organization Administrator, after you grant access to applications in Exchange, a contract is automatically created between the API instance and the application. The contract gives access to the application based on SLA tiers that you might specify. Only one contract can exist per API instance and application at any time.

=== API Alerts
An API alert (different from a Runtime Manager alert) is an alarm that flags one of the following:

* The API request violates a policy
* Requests received by the API exceed a given number within a period of time
* The API returns a specified HTTP error code
* The API response time exceeds a certain amount

API Manager triggers alerts when states change from desirable to undesirable or vice versa. When an alert triggers, API Manager sends email notifications to you and to others, if configured.

=== Applications
Applications are packages that integrate connectors, modules, and components. An application's main purpose is to read, write, and process data. Typically, applications read data from internal and external sources, process and transform data to the required formats or structures, and write output to the systems and servers where you store or use the transformed data. You build applications with Anypoint Studio.

Applications are also referred to as:

* Mule Applications
* Mule Runtime Engine Applications
* Client Applications
* Developer Client Applications
* Integration Applications

=== API Analytics
API Analytics can provide insight into how your APIs are being used and how they are performing. From API Manager, you can access the Analytics dashboard, create a custom dashboard, create and manage charts, and create reports.

image::analytics-request.png[]

=== API Assets
API assets, published by Exchange, are the components that comprise applications. Components include any of the following:

* APIs (OAS, RAML, RAML fragments, HTTP, WSDL, and Custom)
* API Groups
* Policies
* Examples
* Templates
* Modules
* Connectors owned by MuleSoft or your organization

=== API Groups
An API Group is an API asset that enables organizations to publish a group of API instances as a single unit, so that applications can access the APIs as a group using one client ID and, optionally, client secret. API Groups are created in Anypoint API Manager and published to Exchange.

=== API Instances
Instances of an API can exist in multiple environments. Additionally, you can create multiple instances of an API in the same environment.

You can create one instance of an API that serves as a proxy, with applied caching policies. You can create another to manage directly as a basic endpoint, with applied throttling policies and security policies.

The API Manager dashboard shows key information about a deployed API instance:

image::dashboard-legend.png[]

=== Autodiscovery Schemes
Through the Autodiscovery scheme, API Manager can track the API throughout the life cycle as you modify, version, deploy, govern, and publish it.

=== Business Groups
A system administrator groups individuals within an organization into business groups. Each group has its own Exchange API assets, and its own environments.

=== Environments
Anypoint Platform enables you to create and manage separate deployment environments for APIs and applications. These environments are independent from each other and enable you to test your applications under the same conditions as your production environment.

The support for environments in strategic components of Anypoint Platform eliminates the need to construct version names to reflect an environment. Restricting access to and managing environments is also simplified. Permissions to access APIs are environment-based.

== Hello World
The following procedure describes how to:

* Create a RAML API specification in Design Center
* Publish the API specification to Exchange
* Use API Manager to apply a rate-limiting policy to the API
* Use Studio to create a Mule application and download the API specification from Exchange
* Use Studio to deploy the API to a local Mule runtime
* Test the API against the local Mule runtime

=== Before You Begin
Within Anypoint Platform, your user ID must be assigned the _Design Center Developer_ permission, or you must be the Organization Owner. See xref:access-management::managing-permissions.adoc[Managing Permissions] for more information.

Additionally, download and install the latest version of Studio. For more information, refer to xref:studio::to-download-and-install-studio.adoc[Downloading and Installing Anypoint Studio].

=== Step 1: Create the API specification in Design Center
The first step in creating a Hello World deployment is to build the API specification in Design Center.

. Click Design Center after signing into Anypoint Platform. The Projects list appears.
. On the Projects page, click *Create new*.
. Select *New API Spec*.
. In the *New API Spec* dialog, name your project. 
. Select the *Iâ€™m comfortable designing it on my own* option.
. Under *Specification Language*, choose *RAML 1.0*.
+ 
API Designer creates the stubs of your API specification using the specification type and version you choose.
. Replace the contents of the text editor with the following specification:
+
----
#%RAML 1.0
version: v1
title: Hello World # required title

/hello-world: # optional resource
  get: # HTTP method declaration
    responses: # declare a response
      200: # HTTP status code
        body: # declare content of response
          application/json: # media type
            # structural definition of a response (schema or type)
            type: object
            properties:
              message: string
            example: # example how a response looks like
              message: "Hello world!"
----

. In the top-right corner of API Designer, click *Publish* and then click *Publish to Exchange*.
. In the subsequent dialog, complete the required fields with the given suggestions and click *Publish to Exchange*.
+
For additional information about publishing to Exchange, refer to xref:design-center::design-publish.adoc[Publish an API Specification].

=== Step 2: Manage the API

==== Step 2.1 Add the API to API Manager

. In the navigation menu, click API Manager.
. Click *Manage API*.
. API Manager manages APIs from Exchange, or you can import APIs in a ZIP file from the file system. For this procedure, select *Manage API from Exchange*.
. In the *Manage API from Exchange* view, type the name of your API next to the *API Name* label and select the API from the dropdown list. The remaining text fields will auto-populate with your API configuration details.
. Next to *Managing type*, select *Basic Endpoint* (the default selection) and enable *Select if you are managing this API using Mule 4 or above.*
. Click *Save* to finish configuring the API. 

==== Step 2.2: Apply a Policy

You can now perform management tasks like applying policies, configuring SLA tiers, assigning permissions to the API environment, versioning, viewing API analytics, and more. 

For this procedure, apply the *Rate limiting* proxy. 

. Click *API Management* from the left-hand menu to return to the API dashboard.
. Click the icon next to the API name. 
. Click the version number of the API.
+
image::hello-world-api-manager-version-icon.png[70%,70%]
. Click *Policies* from the left-hand menu.
. Click *Apply New Policy*.
. Scroll down to and select *Rate limiting*.
+
The *Rate limiting* policy specifies the maximum value for the number of messages processed per given time period, and rejects any messages beyond the maximum. The policy can be applied to all API calls, as opposed to the *Rate limiting - SLA based* policy, which can be applied to specific APIs.
. Click *Configure Policy*.
. Specify the following under *Limits*:
* *# of Reqs*: 3
* *Time Period*: 1
* *Time Unit*: Minute
. Click *Apply*.
+ 
The *Rate limiting* policy is now applied to all API requests. 

==== Step 2.3: Copy Required Information

Before moving on, you must copy the following information that will be used to configure Studio:

. The Autodiscovery *API ID*, which is used to sync API Manager and Studio.
+
Click *Settings* and copy the value under *Autodiscovery* into an application such as Notepad. See xref:api-auto-discovery-new-concept.adoc[API Autodiscovery] for more information.
+
image::hello-world-api-manager-autodiscovery.png[60%,60%]
. The environment *Client ID* and *Client Secret*, which are used by Studio to deploy the API in the correct environment.
+ 
Click *API Administration* to return to the API dashboard. Click *Environment information* and copy the values under *Environment* *Client credentials*.

=== Step 3: Implement and Deploy the API in Studio
Once the API specification has been published to Exchange and a policy has been applied in API Manager, it is now possible to implement the API and deploy the API locally - via Studio.

==== Step 3.1: Import the API Specification

. In the taskbar at the top of the Studio display, select *File* > *New* > *Mule Project*.
. Type a name for your project.
. Select a Mule runtime engine version 4.1.4 or later.
. In the *API Specification* section, select the *Import a published API* tab.
. Click the *Add* icon (image:add-icon.png[2%,2%]) and select *From Exchange*.
. Select your Anypoint Platform username.
+
If you are not logged in, you can click the *Add Account* button to add your Anypoint Platform account.
. From the list of available APIs, select your API and click the *Add* button.
. Click *Finish*.

==== Step 3.2: Sync the API with API Manager via Autodiscovery

. Select the *Global Elements* tab in the Mule Configuration File editor.
. Click the *Create* button, and select the *API Autodiscovery* component under *Component configurations*.
+
(image:hello-world-studio-autodiscovery.png[75%,75%])

. Set the *API ID* to the Autodiscovery *API ID* value you previously copied and stored.
. Click *OK*. 

==== Step 3.3: Configure Studio with Environment

. Open the Studio *Preferences* pane. 
. Select *API Manager* under *Anypoint Studio*.
. Under *Environment Credentials*, populate the *Client id* and *Client Secret* fields with the values you previously copied and stored.
. Click *Validate* to verify the credentials are correct.
. Click *Apply and Close*.

==== Step 3.4: Deploy the Application

. Select the *Run* menu bar item, then select *Run* from the menu options. This deploys the API to a local Mule runtime. Deploying to a local Mule runtime is beneficial for development and debugging the API.
. Verify the following appears on the last line of the *Console*:
+
----
Applied policy rate-limiting-1511948 version 1.3.4 to API hello-world-v1-v1:16639950 (16639950) in application hello-world
----
+
This log output indicates that the deployment was successful, and that the policy was successfully applied.

==== Step 3.5: Test the API via `curl`
The `curl` command line tool is used to transfer data with various network protocols. The name stands for "Client URL". 

In this procedure, `curl` invokes the API request then prints the response.

. Open a command line client such as Terminal.
. Type the following `curl` command into the command line client:
+
----
curl http://localhost:8081/api/hello-world
----
. Verify the following response:
+
----
{
  "message": "Hello world!!"
}
----
. Since the *Rate limiting - SLA based* policy was configured to only allow three requests per minute, repeat the above `curl` command three more times and validate the following response:
+
----
{
  "error": "Quota has been exceeded"
}
----
+
This output validates that the policy has been applied and is being enforced within the Mule runtime.
